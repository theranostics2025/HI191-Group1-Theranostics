{% extends 'base.html' %}
{% load static %}
{% load custom_filters %}

{% block content %}
<style>
    h5:not(.should-not-apply)  {
        margin-top: 8px;
    }
</style>

<!-- <h1 class="title text-left" style="color: black; font-size: xx-large; margin-left: 0px;"><b>{{ patient.name }}</b></h1> -->
<div class = "container-fluid mt-1 table-container" style="background-color: transparent; border-color: transparent;">
    <div class="row">
        <div class="col">
            <h3><b>Patient Details</b></h3>
            <ul style="display: grid; background-image: none;">
                <li><strong>Name:</strong> {{ patient.name }}</li>
                <li><strong>Age:</strong> {{ patient.age }}</li>
                <li><strong>Address:</strong> {{ patient.address }}</li>
                <li><strong>Diagnosis Date:</strong> {{ patient.diagnosis_date }}</li>
                <li><strong>Surgery Date:</strong> {{ patient.surgery_date }}</li>
                <li><strong>Gleason Score:</strong> {{ patient.gleason_score }}</li>
                <li><strong>Treatment Date:</strong> {{ patient.date_of_treatment }}</li>
                <li><strong>Treatment Type:</strong> {{ patient.type_of_treatment }}</li>
                <li><strong>Histopath Details:</strong> {{ patient.histopath_details }}</li>
            </ul>
        </div>
        <div class="col">
            {% if patient.histopath_result %}
            <h3><strong>Histopath Result</strong></h3> <img src="{{ patient.histopath_result.url }}" alt="" width="400" style="border-radius: 5px; border: solid maroon;"></li>
            {% endif %}
        </div>
    </div>
</div>
<div class = "container mt-1" style="display: inline;">
    <div class = "row overflow-auto border border-dark pb-5 shadow" style="height: 500px; background-color: rgb(245, 245, 245);">
        <div class = "col">
            <h4 class="mt-2"><b>Physical Exam</b></h4>
                {% if physical_exam %}
                {% else %}
                    <a href="{% url 'addPhysicalExam' patient.slug %}" class="mr-1"><button href="{% url 'addPhysicalExam' patient.slug %}" style="margin-top: 20px;"class="btn btn-success" type="button">Add Physical Exam</button></a>
                {% endif %}
                {% if physical_exam %}
                    <!-- slug: {{ physical_exam.slug }}
                    <br> -->
                    <strong>Date of Physical Exam:</strong> {{ physical_exam.date_recorded }}
                    <br>
                    <strong>Height (cm):</strong> {{ physical_exam.height|clean_float }}
                    <br>
                    <strong>Weight (kg):</strong> {{ physical_exam.weight|clean_float }}
                    <br>
                    <strong>BMI (kg/mÂ²):</strong> {{ physical_exam.bmi }}
                    <br>
                    <strong>Blood Pressure (mmHg):</strong> {{ physical_exam.bp }}
                    <br>
                    <strong>Heart Rate (bpm):</strong> {{ physical_exam.hr }}
                    <br>
                    <strong>ECOG Score:</strong> {{ physical_exam.ecog_score }}
                    <br>
                    <strong>Pain Score (0-10):</strong> {{ physical_exam.pain_score }}
                    <br>
                    <strong>Local Symptoms:</strong> {{ physical_exam.local_symptoms|default:"None" }}
                    <br>
                    <strong>Systemic Symptoms:</strong> {{ physical_exam.systemic_symptoms|default:"None" }}
                    <br>
                    <a href="{% url 'editPhysicalExam' slug=patient.slug id=physical_exam.id %}" class="mr-1"><button href="{% url 'editPhysicalExam' slug=patient.slug id=physical_exam.id %}" style="margin-top: 20px;"class="btn btn-success" type="button">Edit</button></a>
                    <button type="button" class="btn btn-danger mr-1" style="margin-top: 20px;" data-bs-toggle="modal" href="#deletePEPopup{{physical_exam.id}}">Delete</button>
                    <div class="modal fade" id="deletePEPopup{{physical_exam.id}}" tabindex="-1" role="dialog" aria-labelledby="deletePatientLabel" aria-hidden="true">
                        <div class="modal-dialog" style="display: flex; margin-top: 10%;" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Delete Record?</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            </div>
                            <div class="modal-body">
                            Delete this record?
                            </div>
                            <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <a class="btn btn-danger" href="{% url 'deletePhysicalExam' slug=patient.slug id=physical_exam.id %}">Delete</a>
                            </div>
                        </div>
                        </div>
                    </div>
                {% endif %}
        </div>
        <div class = "col">
            <h4 class="mt-2"><b>Therapy</b></h4>
            <a href="{% url 'addTherapy' patient.slug %}" class="mr-1 btn btn-success mt-1">Add Therapy</a>
            <h4 class="mt-2">Therapies Done</h4>
            <div class="accordion mt-2" id="accordionPanelsStayOpenExample" style="width: 90%;">
                <div class="accordion-item">
                    {% for therapy in therapy %}
                        <h2 class="accordion-header" id="panelsStayOpen-heading{{forloop.counter}}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpen-collapse{{forloop.counter}}" aria-expanded="true" aria-controls="panelsStayOpen-collapse{{forloop.counter}}">
                            <b>Therapy {{forloop.counter}}</b>
                            </button>
                        </h2>
                        <div id="panelsStayOpen-collapse{{forloop.counter}}" class="accordion-collapse collapse" aria-labelledby="panelsStayOpen-heading{{forloop.counter}}">
                            <div class="accordion-body">
                                {% if therapy %}
                                    <strong>Date of PSMA:</strong> {{therapy.date_of_psma}}
                                    <br>
                                    <strong>Premedications:</strong> {{therapy.premedications|default:"None"}}
                                    <br>
                                    <strong>Medications:</strong> {{therapy.medications|default:"None"}}
                                    <br>
                                    <strong>Furosemide:</strong> {{therapy.furosemide}}
                                    <br> 
                                    <strong>Systolic (mmHg):</strong> {{therapy.systolic}}
                                    <br>
                                    <strong>Diastolic (mmHg):</strong> {{therapy.diastolic}}
                                    <br>
                                    <strong>Heart Rate (bpm):</strong> {{therapy.hr}}
                                    <br>
                                    <strong>Respiration Rate (breaths/min):</strong> {{therapy.rr}}
                                    <br>
                                    <strong>Oxygen Saturation (%):</strong> {{therapy.saturation}}
                                    <br>
                                    <strong>Date of Therapy:</strong> {{therapy.date_therapy}}
                                    <br>
                                    <strong>Radiopharm:</strong> {{therapy.radiopharm}}
                                    <br>
                                    <strong>Side Effects:</strong> {{therapy.side_effects|default:"None"}}
                                    <br>
                                    <a href="{% url 'editTherapy' slug=patient.slug id=therapy.id %}" class="mr-1"><button href="{% url 'editTherapy' slug=patient.slug id=therapy.id %}" style="margin-top: 20px;"class="btn btn-success" type="button">Edit</button></a>
                                    <button type="button" class="btn btn-danger mr-1" style="margin-top: 20px;" data-bs-toggle="modal" href="#deleteTPopup{{therapy.id}}">Delete</button>
                                    <div class="modal fade" id="deleteTPopup{{therapy.id}}" tabindex="-1" role="dialog" aria-labelledby="deletePatientLabel" aria-hidden="true">
                                        <div class="modal-dialog" style="display: flex; margin-top: 10%;" role="document">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                            <h5 class="modal-title" id="exampleModalLabel">Delete Record?</h5>
                                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                                <span aria-hidden="true">&times;</span>
                                            </button>
                                            </div>
                                            <div class="modal-body">
                                            Delete this record?
                                            </div>
                                            <div class="modal-footer">
                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                            <a class="btn btn-danger" href="{% url 'deleteTherapy' slug=patient.slug id=therapy.id %}">Delete</a>
                                            </div>
                                        </div>
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
    <div class = "row overflow-auto shadow mt-5 rounded border border-dark pb-5" style="height: 500px; background-color: rgb(245, 245, 245);">
        <div class = "col">
            <h2 class="mt-1"><b>Screening</b></h2>
                {% if screening %}
                {% else %}
                    <a href="{% url 'addScreening' patient.slug %}" class="mr-1"><button href="{% url 'addScreening' patient.slug %}" style="margin-top: 20px;"class="btn btn-success" type="button">Add Screening</button></a>
                {% endif %}
                {% if screening %}
                    <strong>PSA (ng/mL):</strong> {{screening.psa|clean_float}}
                    <br>
                    <strong>Creatinine (mg/dL):</strong> {{screening.creatinine|clean_float}}
                    <br>
                    <hr style="margin: 8px 0;">
                    <h5 class="should-not-apply"><b>Complete Blood Count</b></h5>
                    <strong>WBC (billion cells/L):</strong> {{screening.wbc|clean_float}}
                    <br>
                    <strong>RBC (trillion cells/L):</strong> {{screening.rbc|clean_float}}
                    <br>
                    <strong>Hemoglobin Levels (g/L):</strong> {{ screening.hemoglobin|clean_float }}
                    <br>
                    <strong>Hematrocrit (%):</strong> {{screening.hematocrit|clean_float}}
                    <br>
                    <strong>Platelet (billion/L):</strong> {{screening.platelet|clean_float}}
                    <br>
                    <hr style="margin: 8px 0;">
                    <strong>Lactate Hydrogenase (IU/L):</strong> {{screening.lactate_hydrogenase|clean_float}}
                    <br>
                    <strong>Alkaline Phophatase (IU/L):</strong> {{screening.alkaline_phosphatase|clean_float}}
                    <br>
                    <strong>SGPT (U/L):</strong> {{screening.sgpt|clean_float}}
                    <br>
                    <strong>SGOT (U/L):</strong> {{screening.sgot|clean_float}}
                    <br>
                    <strong>Bilirubins (mg/dL):</strong> {{screening.bilirubins|clean_float}}
                    <br>
                    <h5><b>Salivary Glands</b></h5>
                    <strong>Salivary Gland Status:</strong> {{screening.salivary_gland_status|clean_float}}
                    <h5><b>Bone Metastasis</b></h5>
                    <strong>Bone Metastasis Status:</strong> {{screening.bone_metastasis_status|clean_float}}
                    <h2><b>ASSESSMENT</b></h2>
                    {{screening.assessment}}
                    <h2><b>PLAN</b></h2>
                    {{screening.plan}}
                    <br>
                    <a href="{% url 'editScreening' slug=patient.slug id=screening.id %}" class="mr-1 mt-1"><button href="{% url 'editScreening' slug=patient.slug id=screening.id %}" style="margin-top: 20px;"class="btn btn-success" type="button">Edit Screening</button></a>
                    <br>
                    <button type="button" class="btn btn-danger mr-1" style="margin-top: 10px;" data-bs-toggle="modal" href="#deleteSPopup{{screening.id}}">Delete Screening</button>
                    <div class="modal fade" id="deleteSPopup{{screening.id}}" tabindex="-1" role="dialog" aria-labelledby="deletePatientLabel" aria-hidden="true">
                        <div class="modal-dialog" style="display: flex; margin-top: 10%;" role="document">
                        <div class="modal-content">
                            <div class="modal-header">
                            <h5 class="modal-title" id="exampleModalLabel">Delete Record?</h5>
                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                <span aria-hidden="true">&times;</span>
                            </button>
                            </div>
                            <div class="modal-body">
                            Delete this record?
                            </div>
                            <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                            <a class="btn btn-danger" href="{% url 'deleteScreening' slug=patient.slug id=screening.id %}">Delete</a>
                            </div>
                        </div>
                        </div>
                    </div>
                {% endif %}
        </div>
        <div class="col">
            {% if screening %}
                <h4 class="mt-2"><b>GAPSMA</b></h4>
                <strong>GAPSMA:</strong> {{screening.gapsma_choices}}

                <h5><b>Prostate Glands</b></h5>
                <strong>Lesion Status:</strong> {{screening.gapsma_prostate_lesion_status|default:"N/A"}}<br>
                {% if screening.gapsma_prostate_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.gapsma_prostate_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.gapsma_prostate_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.gapsma_prostate_size|clean_float}}<br>
                {% endif %}

                <h5><b>Lymph Nodes</b></h5>
                <strong>Lesion Status:</strong> {{screening.gapsma_lymph_node_lesion_status|default:"N/A"}}<br>
                {% if screening.gapsma_lymph_node_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.gapsma_lymph_node_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.gapsma_lymph_node_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.gapsma_lymph_node_size|clean_float}}<br>
                {% endif %}

                <h5><b>Bones</b></h5>
                <strong>Lesion Status:</strong> {{screening.gapsma_bone_lesion_status|default:"N/A"}}<br>
                {% if screening.gapsma_bone_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.gapsma_bone_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.gapsma_bone_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.gapsma_bone_size|clean_float}}<br>
                {% endif %}

                <h5><b>Brain</b></h5>
                <strong>Lesion Status:</strong> {{screening.gapsma_brain_lesion_status|default:"N/A"}}<br>
                {% if screening.gapsma_brain_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.gapsma_brain_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.gapsma_brain_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.gapsma_brain_size|clean_float}}<br>
                {% endif %}

                <h5><b>Lungs</b></h5>
                <strong>Lesion Status:</strong> {{screening.gapsma_lung_lesion_status|default:"N/A"}}<br>
                {% if screening.gapsma_lung_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.gapsma_lung_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.gapsma_lung_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.gapsma_lung_size|clean_float}}<br>
                {% endif %}

                <h5><b>Liver</b></h5>
                <strong>Lesion Status:</strong> {{screening.gapsma_liver_lesion_status|default:"N/A"}}<br>
                {% if screening.gapsma_liver_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.gapsma_liver_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.gapsma_liver_suv|clean_float}}<br>
                    <strong>Size (mm): </strong> {{screening.gapsma_liver_size|clean_float}}<br>
                {% endif %}
            {% endif %}
        </div>

        <div class="col">
            {% if screening %}
                <h4 class="mt-2"><b>FDG-PET/CT</b></h4>

                <h5><b>Prostate Glands</b></h5>
                <strong>Lesion Status:</strong> {{screening.fdgpetct_prostate_lesion_status|default:"N/A"}}<br>
                {% if screening.fdgpetct_prostate_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.fdgpetct_prostate_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.fdgpetct_prostate_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.fdgpetct_prostate_size|clean_float}}<br>
                {% endif %}

                <h5><b>Lymph Nodes</b></h5>
                <strong>Lesion Status:</strong> {{screening.fdgpetct_lymph_node_lesion_status|default:"N/A"}}<br>
                {% if screening.fdgpetct_lymph_node_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.fdgpetct_lymph_node_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.fdgpetct_lymph_node_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.fdgpetct_lymph_node_size|clean_float}}<br>
                {% endif %}

                <h5><b>Bones</b></h5>
                <strong>Lesion Status:</strong> {{screening.fdgpetct_bone_lesion_status|default:"N/A"}}<br>
                {% if screening.fdgpetct_bone_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.fdgpetct_bone_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.fdgpetct_bone_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.fdgpetct_bone_size|clean_float}}<br>
                {% endif %}

                <h5><b>Brain</b></h5>
                <strong>Lesion Status:</strong> {{screening.fdgpetct_brain_lesion_status|default:"N/A"}}<br>
                {% if screening.fdgpetct_brain_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.fdgpetct_brain_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.fdgpetct_brain_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.fdgpetct_brain_size|clean_float}}<br>
                {% endif %}

                <h5><b>Lungs</b></h5>
                <strong>Lesion Status:</strong> {{screening.fdgpetct_lung_lesion_status|default:"N/A"}}<br>
                {% if screening.fdgpetct_lung_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.fdgpetct_lung_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.fdgpetct_lung_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.fdgpetct_lung_size|clean_float}}<br>
                {% endif %}

                <h5><b>Liver</b></h5>
                <strong>Lesion Status:</strong> {{screening.fdgpetct_liver_lesion_status|default:"N/A"}}<br>
                {% if screening.fdgpetct_liver_lesion_status == "Present" %}
                    <strong>Location:</strong> {{screening.fdgpetct_liver_location|default:"N/A"}}<br>
                    <strong>SUV:</strong> {{screening.fdgpetct_liver_suv|clean_float}}<br>
                    <strong>Size (mm):</strong> {{screening.fdgpetct_liver_size|clean_float}}<br>
                {% endif %}
            {% endif %}
        </div>

        <div class = "col">
                {% if screening %}
                    <h4 class="mt-2"><strong>Salivary Gland</strong></h4>
                    <img src="{{ screening.salivary_gland_image.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">

                    <h4 class="mt-2"><strong>Bone Scan</strong></h4>
                    <img src="{{ screening.bone_scan_image.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">

                    <h4 class="mt-2"><strong>Renal Scintigraphy</strong></h4>
                    <img src="{{ screening.renal_scintigraphy.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">

                    <h4 class="mt-2"><strong>GAPSMA</strong></h4>
                    <img src="{{ screening.gapsma_img.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">

                    <h4 class="mt-2"><strong>FDG-PET/CT</strong></h4>
                    <img src="{{ screening.fdgpetct_img.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">
                {% endif %}
        </div>
    </div>  
    <div class = "row overflow-auto shadow mt-5 rounded border border-dark pb-5" style="height: 500px; background-color: rgb(245, 245, 245);">
        <div class = "col">
            <h4 class="mt-2"><b>Post-Therapy</b></h4>
            <a href="{% url 'addPostTherapy' patient.slug %}" class="mr-1 btn btn-success mt-1">Add Post-Therapy</a>
            <h4 class="mt-2 text-center font-weight-bold">Post-Therapies Done</h4>
            <div class="accordion mx-auto" id="accordionPanelsStayOpenExample" style="width: 90%;">
                <div class="accordion-item">
                    {% for post_therapy in post_therapy %}
                        <h2 class="accordion-header" id="panelsStayOpenpt-heading{{forloop.counter}}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpenpt-collapse{{forloop.counter}}" aria-expanded="true" aria-controls="panelsStayOpenpt-collapse{{forloop.counter}}">
                            <b>Post-therapy {{forloop.counter}}</b>
                            </button>
                        </h2>
                        <div id="panelsStayOpenpt-collapse{{forloop.counter}}" class="accordion-collapse collapse" aria-labelledby="panelsStayOpenpt-heading{{forloop.counter}}">
                            <div class="accordion-body">
                                {% if post_therapy %}
                                    <div class="row">
                                        <div class="col">
                                            <strong>Date of Post Therapy:</strong> {{post_therapy.date_of_post_therapy}}
                                            <br>
                                            <strong>Scan Hours:</strong> {{post_therapy.post_therapy_scan_hours}}
                                            <br>
                                            <strong>with Spect/CT:</strong> {{post_therapy.with_spect_ct}}
                                            <br>
                                            <strong>Lesions:</strong> {{post_therapy.lesions|default:"None"}}
                                            <br> 
                                            <strong>Bone Lesion Details:</strong> {{post_therapy.bone_lesion_details}}
                                            <br>
                                            <h5><b>Dosimetry (Gy)</b></h5>
                                            <strong>Salivary Gland:</strong> {{post_therapy.salivary_gland|clean_float}}
                                            <br>
                                            <strong>Left Kidney:</strong> {{post_therapy.kidney_left|clean_float}}
                                            <br>
                                            <strong>Right Kidney:</strong> {{post_therapy.kidney_right|clean_float}}
                                            <br>
                                            
                                            <a href="{% url 'editPostTherapy' slug=patient.slug id=post_therapy.id %}" class="mr-1 mt-1"><button href="{% url 'editPostTherapy' slug=patient.slug id=post_therapy.id %}" style="margin-top: 20px;"class="btn btn-success" type="button">Edit</button></a>
                                            <button type="button" class="btn btn-danger mr-1" style="margin-top: 20px;" data-bs-toggle="modal" href="#deletePTPopup{{post_therapy.id}}">Delete</button>
                                            <div class="modal fade" id="deletePTPopup{{post_therapy.id}}" tabindex="-1" role="dialog" aria-labelledby="deletePatientLabel" aria-hidden="true">
                                                <div class="modal-dialog" style="display: flex; margin-top: 10%;" role="document">
                                                <div class="modal-content">
                                                    <div class="modal-header">
                                                    <h5 class="modal-title" id="exampleModalLabel">Delete Record?</h5>
                                                    <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                                        <span aria-hidden="true">&times;</span>
                                                    </button>
                                                    </div>
                                                    <div class="modal-body">
                                                    Delete this record?
                                                    </div>
                                                    <div class="modal-footer">
                                                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                    <a class="btn btn-danger" href="{% url 'deletePostTherapy' slug=patient.slug id=post_therapy.id %}">Delete</a>
                                                    </div>
                                                </div>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="col">
                                            <h4 class="mt-2"><strong>Lesion Image</strong></h4> 
                                            <img src="{{ post_therapy.lesion_image.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">
                                            <h4 class="mt-2"><strong>Dosimetry Image</strong></h4>
                                            <img src="{{ post_therapy.dosimetry_image.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">
                                            <br>
                                        </div>
                                    </div>
                                {% endif %}
                                    
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>  
    <div class = "row overflow-auto shadow mt-5 rounded border border-dark pb-5" style="height: 500px; background-color: rgb(245, 245, 245);">
        <div class = "col">
            <h4 class="mt-2"><b>Follow-Up</b></h4>
            <a href="{% url 'addFollowUp' patient.slug %}" class="flex-direction mr-1 btn btn-success mt-1">Add Follow-Up</a>
            <h4 class="mt-2 text-center font-weight-bold">Follow-Ups Done</h4>
            <div class="accordion mx-auto" id="accordionPanelsStayOpenExample" style="width: 100%;">
                <div class="accordion-item">
                    {% for follow_up in follow_up %}
                        <h2 class="accordion-header" id="panelsStayOpenfu-heading{{forloop.counter}}">
                            <button class="accordion-button collapsed" type="button" data-bs-toggle="collapse" data-bs-target="#panelsStayOpenfu-collapse{{forloop.counter}}" aria-expanded="true" aria-controls="panelsStayOpenfu-collapse{{forloop.counter}}">
                            <b>Follow-up {{forloop.counter}}</b>
                            </button>
                        </h2>
                        <div id="panelsStayOpenfu-collapse{{forloop.counter}}" class="accordion-collapse collapse" aria-labelledby="panelsStayOpenfu-heading{{forloop.counter}}">
                            <div class="accordion-body">
                                {% if follow_up %}
                                    <div class="row">
                                        <div class = "col">
                                                {% if follow_up %}
                                                    <strong>Date:</strong> {{follow_up.date_of_follow_up}}
                                                    <br>
                                                    <strong>PSA (ng/mL):</strong> {{screening.psa|clean_float}}
                                                    <br>
                                                    <strong>Creatinine (mg/dL):</strong> {{screening.creatinine|clean_float}}
                                                    <br>
                                                    <hr style="margin: 8px 0;">
                                                    <h5 class="should-not-apply"><b>Complete Blood Count</b></h5>
                                                    <strong>WBC (billion cells/L):</strong> {{screening.wbc|clean_float}}
                                                    <br>
                                                    <strong>RBC (trillion cells/L):</strong> {{screening.rbc|clean_float}}
                                                    <br>
                                                    <strong>Hemoglobin Levels (g/L):</strong> {{ screening.hemoglobin|clean_float }}
                                                    <br>
                                                    <strong>Hematrocrit (%):</strong> {{screening.hematocrit|clean_float}}
                                                    <br>
                                                    <strong>Platelet (billion/L):</strong> {{screening.platelet|clean_float}}
                                                    <br>
                                                    <hr style="margin: 8px 0;">
                                                    <strong>Lactate Hydrogenase (IU/L):</strong> {{screening.lactate_hydrogenase|clean_float}}
                                                    <br>
                                                    <strong>Alkaline Phophatase (IU/L):</strong> {{screening.alkaline_phosphatase|clean_float}}
                                                    <br>
                                                    <strong>SGPT (U/L):</strong> {{screening.sgpt|clean_float}}
                                                    <br>
                                                    <strong>SGOT (U/L):</strong> {{screening.sgot|clean_float}}
                                                    <br>
                                                    <strong>Bilirubins (mg/dL):</strong> {{screening.bilirubins|clean_float}}
                                                    <br>
                                                    <h5><b>Salivary Glands</b></h5>
                                                    <strong>Salivary Gland Status:</strong> {{follow_up.salivary_gland_status|clean_float}}
                                                    <h5><b>Bone Metastasis</b></h5>
                                                    <strong>Bone Metastasis Status:</strong> {{follow_up.bone_metastasis_status|clean_float}}
                                                    <h2><strong>ASSESSMENT</strong></h2>
                                                    {{follow_up.assessment}}
                                                    <h2><strong>PLAN</strong></h2>
                                                    {{follow_up.plan}}
                                                    <br>
                                                    <a href="{% url 'editFollowUp' slug=patient.slug id=follow_up.id %}" class="mr-1 mt-1"><button href="{% url 'editFollowUp' slug=patient.slug id=follow_up.id %}" style="margin-top: 20px;"class="btn btn-success" type="button">Edit Follow-Up</button></a>
                                                    <br>
                                                    <button type="button" class="btn btn-danger mr-1" style="margin-top: 10px;" data-bs-toggle="modal" href="#deleteFUPopup{{follow_up.id}}">Delete Follow-Up</button>
                                                    <div class="modal fade" id="deleteFUPopup{{follow_up.id}}" tabindex="-1" role="dialog" aria-labelledby="deletePatientLabel" aria-hidden="true">
                                                        <div class="modal-dialog" style="display: flex; margin-top: 10%;" role="document">
                                                        <div class="modal-content">
                                                            <div class="modal-header">
                                                            <h5 class="modal-title" id="exampleModalLabel">Delete Record?</h5>
                                                            <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                                                                <span aria-hidden="true">&times;</span>
                                                            </button>
                                                            </div>
                                                            <div class="modal-body">
                                                            Delete this record?
                                                            </div>
                                                            <div class="modal-footer">
                                                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                                                            <a class="btn btn-danger" href="{% url 'deleteFollowUp' slug=patient.slug id=follow_up.id %}">Delete</a>
                                                            </div>
                                                        </div>
                                                        </div>
                                                    </div>
                                                {% endif %}
                                        </div>
                                        <div class="col">
                                            {% if follow_up %}
                                                <h4 class="mt-2"><b>GAPSMA</b></h4>
                                                <strong>GAPSMA:</strong> {{follow_up.gapsma_choices}}
                                                
                                                <h5><b>Prostate Glands</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.gapsma_prostate_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.gapsma_prostate_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.gapsma_prostate_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.gapsma_prostate_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.gapsma_prostate_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Lymph Nodes</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.gapsma_lymph_node_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.gapsma_lymph_node_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.gapsma_lymph_node_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.gapsma_lymph_node_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.gapsma_lymph_node_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Bones</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.gapsma_bone_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.gapsma_bone_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.gapsma_bone_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.gapsma_bone_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.gapsma_bone_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Brain</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.gapsma_brain_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.gapsma_brain_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.gapsma_brain_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.gapsma_brain_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.gapsma_brain_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Lungs</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.gapsma_lung_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.gapsma_lung_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.gapsma_lung_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.gapsma_lung_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.gapsma_lung_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Liver</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.gapsma_liver_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.gapsma_liver_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.gapsma_liver_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.gapsma_liver_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.gapsma_liver_size|clean_float}}<br>
                                                {% endif %}
                                            {% endif %}
                                        </div>

                                        <div class="col">
                                            {% if follow_up %}
                                                <h4 class="mt-2"><b>FDG-PET/CT</b></h4>

                                                <h5><b>Prostate Glands</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.fdgpetct_prostate_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.fdgpetct_prostate_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.fdgpetct_prostate_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.fdgpetct_prostate_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.fdgpetct_prostate_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Lymph Nodes</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.fdgpetct_lymph_node_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.fdgpetct_lymph_node_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.fdgpetct_lymph_node_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.fdgpetct_lymph_node_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.fdgpetct_lymph_node_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Bones</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.fdgpetct_bone_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.fdgpetct_bone_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.fdgpetct_bone_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.fdgpetct_bone_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.fdgpetct_bone_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Brain</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.fdgpetct_brain_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.fdgpetct_brain_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.fdgpetct_brain_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.fdgpetct_brain_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.fdgpetct_brain_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Lungs</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.fdgpetct_lung_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.fdgpetct_lung_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.fdgpetct_lung_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.fdgpetct_lung_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.fdgpetct_lung_size|clean_float}}<br>
                                                {% endif %}

                                                <h5><b>Liver</b></h5>
                                                <strong>Lesion Status:</strong> {{follow_up.fdgpetct_liver_lesion_status|default:"N/A"}}<br>
                                                {% if follow_up.fdgpetct_liver_lesion_status == "Present" %}
                                                    <strong>Location:</strong> {{follow_up.fdgpetct_liver_location|default:"N/A"}}<br>
                                                    <strong>SUV:</strong> {{follow_up.fdgpetct_liver_suv|clean_float}}<br>
                                                    <strong>Size (mm):</strong> {{follow_up.fdgpetct_liver_size|clean_float}}<br>
                                                {% endif %}
                                            {% endif %}
                                        </div>

                                        <div class = "col">
                                                {% if follow_up %}
                                                    <h4 class="mt-2"><strong>Salivary Gland</strong></h4>
                                                    <img src="{{ follow_up.salivary_gland_image.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">
                                
                                                    <h4 class="mt-2"><strong>Bone Scan</strong></h4>
                                                    <img src="{{ follow_up.bone_scan_image.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">
                                
                                                    <h4 class="mt-2"><strong>Renal Scintigraphy</strong></h4>
                                                    <img src="{{ follow_up.renal_scintigraphy.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">
                                
                                                    <h4 class="mt-2"><strong>GAPSMA</strong></h4>
                                                    <img src="{{ follow_up.gapsma_img.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">
                                
                                                    <h4 class="mt-2"><strong>FDG-PET/CT</strong></h4>
                                                    <img src="{{ follow_up.fdgpetct_img.url }}" alt="" width="200" style="border-radius: 5px; border: solid maroon;">
                                                {% endif %}
                                        </div>
                                    </div>
                                {% endif %}
                            </div>
                        </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>  
</div>
{% endblock content %}